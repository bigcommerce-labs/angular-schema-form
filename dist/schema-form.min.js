var deps=[];try{angular.module("ngSanitize"),deps.push("ngSanitize")}catch(e){}try{angular.module("ui.sortable"),deps.push("ui.sortable")}catch(e){}try{angular.module("angularSpectrumColorpicker"),deps.push("angularSpectrumColorpicker")}catch(e){}var schemaForm=angular.module("schemaForm",deps);angular.module("schemaForm").provider("sfPath",[function(){var e=window.ObjectPath||objectpath,t={parse:e.parse};1===angular.version.major&&angular.version.minor<3?t.stringify=function(e){return Array.isArray(e)?e.join("."):e.toString()}:t.stringify=e.stringify,t.normalize=function(e,r){return t.stringify(Array.isArray(e)?e:t.parse(e),r)},this.parse=t.parse,this.stringify=t.stringify,this.normalize=t.normalize,this.$get=function(){return t}}]),angular.module("schemaForm").factory("sfSelect",["sfPath",function(e){var t=/^\d+$/;return function(r,n,a){n||(n=this);var i="string"==typeof r?e.parse(r):r;if("undefined"!=typeof a&&1===i.length)return n[i[0]]=a,n;"undefined"!=typeof a&&"undefined"==typeof n[i[0]]&&(n[i[0]]=i.length>2&&t.test(i[1])?[]:{});for(var o=n[i[0]],l=1;l<i.length;l++){if(""===i[l])return void 0;if("undefined"!=typeof a){if(l===i.length-1)return o[i[l]]=a,a;var s=o[i[l]];("undefined"==typeof s||null===s)&&(s=t.test(i[l+1])?[]:{},o[i[l]]=s),o=s}else o&&(o=o[i[l]])}return o}}]),angular.module("schemaForm").provider("sfBuilder",["sfPathProvider",function(e){var t=/[A-Z]/g,r=function(e,r){return r=r||"_",e.replace(t,function(e,t){return(t?r:"")+e.toLowerCase()})},n=0;"firstElementChild"in document.createDocumentFragment()||Object.defineProperty(DocumentFragment.prototype,"firstElementChild",{get:function(){for(var e,t=this.childNodes,r=0,n=t.length;n>r;++r)if(e=t[r],1===e.nodeType)return e;return null}});var a={sfField:function(e){e.fieldFrag.firstElementChild.setAttribute("sf-field",n),e.lookup["f"+n]=e.form,n++},ngModel:function(t){if(t.form.key){var r=t.form.key;t.state.keyRedaction&&(r=r.slice(t.state.keyRedaction));var n;if(t.state.modelValue)n=t.state.modelValue;else{var a=e.stringify(r).replace(/"/g,"&quot;");n=t.state.modelName||"model",a&&(n+=("["!==a[0]?".":"")+a)}for(var i=t.fieldFrag.querySelectorAll("[sf-field-model]"),o=0;o<i.length;o++){var l=i[o],s=l.getAttribute("sf-field-model");if(s&&""!==s)if("replaceAll"===s)for(var u=l.attributes,c=0;c<u.length;c++)u[c].value&&-1!==u[c].value.indexOf("$$value")&&(u[c].value=u[c].value.replace(/\$\$value\$\$/g,n));else{var f=l.getAttribute(s);f&&f.indexOf("$$value$$")?l.setAttribute(s,f.replace(/\$\$value\$\$/g,n)):l.setAttribute(s,n)}else l.setAttribute("ng-model",n)}}},simpleTransclusion:function(e){var t=e.build(e.form.items,e.path+".items",e.state);e.fieldFrag.firstChild.appendChild(t)},ngModelOptions:function(e){e.form.ngModelOptions&&Object.keys(e.form.ngModelOptions).length>0&&e.fieldFrag.firstChild.setAttribute("ng-model-options",JSON.stringify(e.form.ngModelOptions))},transclusion:function(e){var t=e.fieldFrag.querySelectorAll("[sf-field-transclude]");if(t.length)for(var r=0;r<t.length;r++){var n=t[r],a=n.getAttribute("sf-field-transclude")||"items",i=e.form[a];if(i){var o=e.build(i,e.path+"."+a,e.state);n.appendChild(o)}}},oneOfTransclusion:function(t){var r=t.fieldFrag.querySelectorAll("[sf-field-oneof-transclude]");r.forEach(function(r){var n=r.getAttribute("sf-field-oneof-transclude")||"items",a=t.form[n]||[],i="selectors"+e.stringify(t.form.key).replace(/"/g,"&quot;");a.forEach(function(e){var a=document.createElement("div"),o=t.build([e],t.path+"."+n,t.state);a.setAttribute("ng-show",i+" === '"+e.title+"'"),r.appendChild(a).appendChild(o)})})},condition:function(t){if(t.form.condition){var r="evalExpr("+t.path+'.condition, { model: model, "arrayIndex": $index})';if(t.form.key){var n=e.stringify(t.form.key);r="evalExpr("+t.path+'.condition,{ model: model, "arrayIndex": $index, "modelValue": model'+("["===n[0]?"":".")+n+"})"}for(var a=t.fieldFrag.children||t.fieldFrag.childNodes,i=0;i<a.length;i++){var o=a[i],l=o.getAttribute("ng-if");o.setAttribute("ng-if",l?"("+l+") || ("+r+")":r)}}},array:function(t){var r=t.fieldFrag.querySelector("[schema-form-array-items]");if(r){if(state=angular.copy(t.state),state.keyRedaction=0,state.keyRedaction+=t.form.key.length+1,t.form.schema&&t.form.schema.items&&t.form.schema.items.type&&-1===t.form.schema.items.type.indexOf("object")&&-1===t.form.schema.items.type.indexOf("array")){e.stringify(t.form.key).replace(/"/g,"&quot;")+"[$index]";state.modelValue="modelArray[$index]"}else state.modelName="item";state.arrayCompatFlag=!0;var n=t.build(t.form.items,t.path+".items",state);r.appendChild(n)}}};this.builders=a;var i=[a.sfField,a.ngModel,a.ngModelOptions,a.condition];this.stdBuilders=i,this.$get=["$templateCache","schemaFormDecorators","sfPath",function(e,t,n){var o=function(e,t){if(e.key){var r=t[n.stringify(e.key)];if(r){for(;r.firstChild;)r.removeChild(r.firstChild);return r}}},l=function(e,t,n,a,i,s,u){s=s||{},u=u||Object.create(null),i=i||"schemaForm.form";var c=document.createDocumentFragment();return e.reduce(function(e,c,f){if(!c.type)return e;var d=t[c.type]||t["default"];if(d.replace){var m;s.arrayCompatFlag=!1;var p=document.createElement("div"),h=n(c,d)||n(c,t["default"]);for(p.innerHTML=h,m=document.createDocumentFragment();p.childNodes.length>0;)m.appendChild(p.childNodes[0]);var g={fieldFrag:m,form:c,lookup:u,state:s,path:i+"["+f+"]",build:function(e,r,i){return l(e,t,n,a,r,i,u)}},v=c.builder||d.builder;"function"==typeof v?v(g):v.forEach(function(e){e(g)}),(o(c,a)||e).appendChild(m)}else{var y=document.createElement(r(t.__name,"-"));s.arrayCompatFlag?y.setAttribute("form","copyWithIndex($index)"):y.setAttribute("form",i+"["+f+"]"),(o(c,a)||e).appendChild(y)}return e},c),c};return{build:function(t,r,n,a){return l(t,r,function(t,r){return"template"===t.type?t.template:e.get(r.template)},n,void 0,void 0,a)},builder:a,stdBuilders:i,internalBuild:l}}]}]),angular.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(e,t){var r="",n={},a=function(e,t){"sfDecorator"===e&&(e=r);var a=n[e];return a[t.type]?a[t.type].template:a["default"].template},i=function(r){e.directive(r,["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(e,n,i,o,l,s,u,c,f){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(e,d,m,p){e.$on("schemaFormPropagateNgModelController",function(t,r){t.stopPropagation(),t.preventDefault(),e.ngModel=r}),e.showTitle=function(){return e.form&&e.form.notitle!==!0&&e.form.title},e.listToCheckboxValues=function(e){var t={};return angular.forEach(e,function(e){t[e]=!0}),t},e.checkboxValuesToList=function(e){var t=[];return angular.forEach(e,function(e,r){e&&t.push(r)}),t},e.buttonClick=function(t,r){angular.isFunction(r.onClick)?r.onClick(t,r):angular.isString(r.onClick)&&(p?p.evalInParentScope(r.onClick,{$event:t,form:r}):e.$eval(r.onClick,{$event:t,form:r}))},e.evalExpr=function(t,r){return p?p.evalInParentScope(t,r):e.$eval(t,r)},e.evalInScope=function(t,r){return t?e.$eval(t,r):void 0},e.interp=function(e,t){return e&&l(e)(t)},e.hasSuccess=function(){return e.ngModel?e.ngModel.$valid&&(!e.ngModel.$pristine||!e.ngModel.$isEmpty(e.ngModel.$modelValue)):!1},e.hasError=function(){return e.ngModel?e.ngModel.$invalid&&!e.ngModel.$pristine:!1},e.errorMessage=function(t){return u.interpolate(t&&t.code+""||"default",e.ngModel&&e.ngModel.$modelValue||"",e.ngModel&&e.ngModel.$viewValue||"",e.form,e.options&&e.options.validationMessage)};var h=e.$watch(m.form,function(l){if(l){l.ngModelOptions=l.ngModelOptions||{},e.form=l;var u;if("template"===l.type&&l.template)u=s.when(l.template);else{var m="template"===l.type?l.templateUrl:a(r,l);u=i.get(m,{cache:o}).then(function(e){return e.data})}u.then(function(r){if(l.key){var a=l.key?t.stringify(l.key).replace(/"/g,"&quot;"):"";r=r.replace(/\$\$value\$\$/g,"model"+("["!==a[0]?".":"")+a)}if(d.html(r),l.condition){var i='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex})';l.key&&(i='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+c.stringify(l.key)+"})"),angular.forEach(d.children(),function(e){var t=e.getAttribute("ng-if");e.setAttribute("ng-if",t?"("+t+") || ("+i+")":i)})}n(d.contents())(e)}),l.key&&(e.$on("schemaForm.error."+l.key.join("."),function(t,r,n,a,i){i=a,(n===!0||n===!1)&&(a=n,n=void 0),(void 0==i||e.ngModel.$$parentForm.$name===i)&&e.ngModel&&r&&(e.ngModel.$setDirty?e.ngModel.$setDirty():(e.ngModel.$dirty=!0,e.ngModel.$pristine=!1),n&&(l.validationMessage||(l.validationMessage={}),l.validationMessage[r]=n),e.ngModel.$setValidity(r,a===!0),a===!0&&(e.ngModel.$validate(),e.$broadcast("schemaFormValidate")))}),e.$on("$destroy",function(){if(!e.externalDestructionInProgress){var t=l.destroyStrategy||e.options&&e.options.destroyStrategy||"remove";if(l.key&&"retain"!==t){var r=e.model;if(l.key.length>1&&(r=f(l.key.slice(0,l.key.length-1),r)),void 0===r)return;var n=l.schema&&l.schema.type||"";"empty"===t&&-1!==n.indexOf("string")?r[l.key.slice(-1)]="":"empty"===t&&-1!==n.indexOf("object")?r[l.key.slice(-1)]={}:"empty"===t&&-1!==n.indexOf("array")?r[l.key.slice(-1)]=[]:"null"===t?r[l.key.slice(-1)]=null:delete r[l.key.slice(-1)]}}})),h()}})}}}])},o=function(t,r,n){n=angular.isDefined(n)?n:!1,e.directive("sf"+angular.uppercase(t[0])+t.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:n,template:'<sf-decorator form="form"></sf-decorator>',link:function(e,r,n){var a={items:"c",titleMap:"c",schema:"c"},i={type:t},o=!0;angular.forEach(n,function(t,r){if("$"!==r[0]&&0!==r.indexOf("ng")&&"sfField"!==r){var l=function(t){angular.isDefined(t)&&t!==i[r]&&(i[r]=t,o&&i.type&&(i.key||angular.isUndefined(n.key))&&(e.form=i,o=!1))};"model"===r?e.$watch(t,function(t){t&&e.model!==t&&(e.model=t)}):"c"===a[r]?e.$watchCollection(t,l):n.$observe(r,l)}})}}})};this.createDecorator=function(e,t){n[e]={__name:e},angular.forEach(t,function(t,r){n[e][r]={template:t,replace:!1,builder:[]}}),n[r]||(r=e),i(e)},this.defineDecorator=function(e,t){n[e]={__name:e},angular.forEach(t,function(t,r){t.builder=t.builder||[],t.replace=angular.isDefined(t.replace)?t.replace:!0,n[e][r]=t}),n[r]||(r=e),i(e)},this.createDirective=o,this.createDirectives=function(e){angular.forEach(e,function(e,t){o(t,e)})},this.decorator=function(e){return e=e||r,n[e]},this.addMapping=function(e,t,r,a,i){n[e]&&(n[e][t]={template:r,builder:a,replace:!!i})},this.defineAddOn=function(e,t,r,a){n[e]&&(n[e][t]={template:r,builder:a,replace:!0})},this.$get=function(){return{decorator:function(e){return n[e]||n[r]},defaultDecorator:r}},i("sfDecorator")}]),angular.module("schemaForm").provider("sfErrorMessage",function(){var e={"default":"Field does not validate",0:"Invalid type, expected {{schema.type}}",1:"No enum match for: {{viewValue}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value is not a multiple of {{schema.multipleOf}}",101:"{{viewValue}} is less than the allowed minimum of {{schema.minimum}}",102:"{{viewValue}} is equal to the exclusive minimum {{schema.minimum}}",103:"{{viewValue}} is greater than the allowed maximum of {{schema.maximum}}",104:"{{viewValue}} is equal to the exclusive maximum {{schema.maximum}}",105:"Value is not a valid number",200:"String is too short ({{viewValue.length}} chars), minimum {{schema.minLength}}",201:"String is too long ({{viewValue.length}} chars), maximum {{schema.maxLength}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minProperties}}",301:"Too many properties defined, maximum {{schema.maxProperties}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minItems}}",401:"Array is too long ({{value.length}}), maximum {{schema.maxItems}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1e3:"Unknown property (not in schema)"};e.number=e[105],e.required=e[302],e.min=e[101],e.max=e[103],e.maxlength=e[201],e.minlength=e[200],e.pattern=e[202],this.setDefaultMessages=function(t){e=t},this.getDefaultMessages=function(){return e},this.setDefaultMessage=function(t,r){e[t]=r},this.$get=["$interpolate",function(t){var r={};return r.defaultMessages=e,r.interpolate=function(r,n,a,i,o){o=o||{};var l=i.validationMessage||{};0===r.indexOf("tv4-")&&(r=r.substring(4));var s=l["default"]||o["default"]||"";[l,o,e].some(function(e){return angular.isString(e)||angular.isFunction(e)?(s=e,!0):e&&e[r]?(s=e[r],!0):void 0});var u={error:r,value:n,viewValue:a,form:i,schema:i.schema,title:i.title||i.schema&&i.schema.title};return angular.isFunction(s)?s(u):t(s)(u)},r}]}),angular.module("schemaForm").provider("schemaForm",["sfPathProvider",function(e){var t=function(e){if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e},r=function(e){var t=[];return e.forEach(function(e){t.push({name:e,value:e})}),t},n=function(e){var t=[];return angular.forEach(e,function(e){t.push({name:e.title,value:e.title})}),t},a=function(e,t){if(!angular.isArray(e)){var r=[];return t?angular.forEach(t,function(t,n){r.push({name:e[t],value:t})}):angular.forEach(e,function(e,t){r.push({name:e,value:t})}),r}return e},i=function(e,r,n){var a=$[t(r.type)];if(a)for(var i,o=0;o<a.length;o++)if(i=a[o](e,r,n))return i.schema["x-schema-form"]&&angular.isObject(i.schema["x-schema-form"])&&(i=angular.extend(i,i.schema["x-schema-form"])),i},o=function(e,t,r){r=r||{};var n=r.global&&r.global.formDefaults?angular.copy(r.global.formDefaults):{};return r.global&&r.global.supressPropertyTitles===!0?n.title=t.title:n.title=t.title||e,t.description&&(n.description=t.description),(r.required===!0||t.required===!0)&&(n.required=!0),t.maxLength&&(n.maxlength=t.maxLength),t.minLength&&(n.minlength=t.minLength),(t.readOnly||t.readonly)&&(n.readonly=!0),t.minimum&&(n.minimum=t.minimum+(t.exclusiveMinimum?1:0)),t.maximum&&(n.maximum=t.maximum-(t.exclusiveMaximum?1:0)),t.validationMessage&&(n.validationMessage=t.validationMessage),t.enumNames&&(n.titleMap=a(t.enumNames,t["enum"])),n.schema=t,n.ngModelOptions=n.ngModelOptions||{},n},l=function(e){if(e.hasOwnProperty("dependencies")){var t={};angular.forEach(e.dependencies,function(e,r){r.match(/_attr/)||(t[r]=e)}),angular.forEach(e.properties,function(r,n){if(t.hasOwnProperty(n)){var a=n+"Group",i=e.required&&-1!==e.required.indexOf(n),o={},l={},s=t[n]||[];l[n]=r,delete e.properties[n],s.forEach(function(t){l[t]=e.properties[t],delete e.properties[s],i&&!o[t]&&(o[t]=!0)}),e.properties[a]={id:a,type:"row",properties:l,required:Object.keys(o)}}})}return e.properties},s=function(e,t,r){return r.sort(function(r,n){var a=-1!=t.indexOf(r.type),i=-1!=t.indexOf(n.type),o=-1!=e.indexOf(r.title),l=-1!=e.indexOf(n.title);return a&&o?i&&l?0:-1:a&&!o?l?1:i?0:-1:!a&&o?l?i?1:0:-1:a||o?void 0:i||l?-1:0})},u=function(r,n,a){if("string"===t(n.type)&&!n["enum"]){var i=o(r,n,a);return i.key=a.path,i.type="text",a.lookup[e.stringify(a.path)]=i,i}},c=function(r,n,a){if("number"===t(n.type)){var i=o(r,n,a);return i.key=a.path,i.type="number",a.lookup[e.stringify(a.path)]=i,i}},f=function(r,n,a){if("integer"===t(n.type)){var i=o(r,n,a);return i.key=a.path,i.type="number",a.lookup[e.stringify(a.path)]=i,i}},d=function(r,n,a){if("boolean"===t(n.type)){var i=o(r,n,a);return i.key=a.path,i.type="checkbox",a.lookup[e.stringify(a.path)]=i,i}},m=function(n,a,i){if("string"===t(a.type)&&a["enum"]){var l=o(n,a,i);return l.key=i.path,l.type="select",l.titleMap||(l.titleMap=r(a["enum"])),i.lookup[e.stringify(i.path)]=l,l}},p=function(n,a,i){if("array"===t(a.type)&&a.items&&a.items["enum"]){var l=o(n,a,i);return l.key=i.path,l.type="checkboxes",l.titleMap||(l.titleMap=r(a.items["enum"])),i.lookup[e.stringify(i.path)]=l,l}},h=function(r,n,a){if("row"===t(n.type)){var l=o(r,n,a),s=e.stringify(a.path);return l.type="row",l.key=a.path,l.items=[],a.lookup[s]=l,angular.forEach(n.properties,function(e,t){var r=a.path.slice(),o=n.required&&-1!==n.required.indexOf(t),u=i(t,e,{path:r,required:o,lookup:a.lookup,ignore:a.ignore,global:a.global});r.pop(),r.push(t),!a.ignore[s]&&u&&l.items.push(u)}),l}},g=function(r,a,l){if("object"===t(a.type)&&a.hasOwnProperty("oneOf")){var s=o(r,a,l),u=e.stringify(l.path);return s.type="fieldselect",s.items=[],s.key=l.path,s.titleMap=s.titleMap||n(a.oneOf),l.lookup[u]=s,angular.forEach(a.properties,function(e,t){var r=l.path.slice(),n=a.required&&-1!==a.required.indexOf(t),o=i(t,e,{path:r,required:n,lookup:l.lookup,ignore:l.ignore,global:l.global});r.push(t),!l.ignore[u]&&o&&s.items.push(o)}),s}},v=function(r,n,a){if("object"===t(n.type)){var s=o(r,n,a),u=l(n);return s.type="fieldset",s.key=a.path,s.items=[],s.dependencies=n.dependencies,a.lookup[e.stringify(a.path)]=s,angular.forEach(u,function(t,r){var o=a.path.slice();if(o.push(r),a.ignore[e.stringify(o)]!==!0){var l=n.required&&-1!==n.required.indexOf(r),u=i(r,t,{path:o,required:l||!1,lookup:a.lookup,ignore:a.ignore,global:a.global});u&&s.items.push(u)}}),s}},y=function(r,n,a){if("array"===t(n.type)){var l=o(r,n,a);l.type="array",l.key=a.path,a.lookup[e.stringify(a.path)]=l;var s=n.required&&-1!==n.required.indexOf(a.path[a.path.length-1]),u=a.path.slice();return u.push(""),l.items=[i(r,n.items,{path:u,required:s||!1,lookup:a.lookup,ignore:a.ignore,global:a.global})],l}},$={string:[m,u],object:[g,v],number:[c],integer:[f],"boolean":[d],array:[p,y],row:[h]},k=function(e){return e};this.defaults=$,this.stdFormObj=o,this.defaultFormDefinition=i,this.postProcess=function(e){k=e},this.appendRule=function(e,t){$[e]||($[e]=[]),$[e].push(t)},this.prependRule=function(e,t){$[e]||($[e]=[]),$[e].unshift(t)},this.createStandardForm=o,this.$get=function(){var r={};return r.merge=function(t,n,i,o,l,s){n=n||["*"],o=o||{},l=l||t.readonly||t.readOnly;var u=r.defaults(t,i,o),c=n.indexOf("*");-1!==c&&(n=n.slice(0,c).concat(u.form).concat(n.slice(c+1)));var f=u.lookup;return k(n.map(function(n){if("string"==typeof n&&(n={key:n}),n.key&&"string"==typeof n.key&&(n.key=e.parse(n.key)),n.titleMap&&(n.titleMap=a(n.titleMap)),n.itemForm){n.items=[];var u=e.stringify(n.key),c=f[u];angular.forEach(c.items,function(e){var t=angular.copy(n.itemForm);t.key=e.key,n.items.push(t)})}if(n.key){var d=e.stringify(n.key);if(f[d]){var m=f[d];angular.forEach(m,function(e,t){void 0===n[t]&&(n[t]=m[t])})}}return l===!0&&(n.readonly=!0),n.items&&(n.items=r.merge(t,n.items,i,o,n.readonly,s)),n.tabs&&angular.forEach(n.tabs,function(e){e.items=r.merge(t,e.items,i,o,n.readonly,s)}),s&&"template"===n.type&&!n.template&&n.templateUrl&&s.push(n),n}))},r.defaults=function(e,r,n){var a=[],o={};if(r=r||{},n=n||{},"object"!==t(e.type))throw new Error('Not implemented. Only type "object" allowed at root level of schema.');var u=l(e);if(angular.forEach(u,function(t,l){if(r[l]!==!0){var s=e.required&&-1!==e.required.indexOf(l),u=i(l,t,{path:[l],lookup:o,ignore:r,required:s,global:n});u&&a.push(u)}}),Array.isArray(e.required)){var c=$.object.map(function(e){return e.name});a=s(e.required,c,a)}return{form:a,lookup:o}},r.traverseSchema=function(e,t,r,n){n=angular.isDefined(n)?n:!0,r=r||[];var a=function(e,t,r){if(t(e,r),angular.forEach(e.properties,function(e,n){var i=r.slice();i.push(n),a(e,t,i)}),!n&&e.items){var i=r.slice();i.push(""),a(e.items,t,i)}};a(e,t,r||[])},r.traverseForm=function(e,t){t(e),angular.forEach(e.items,function(e){r.traverseForm(e,t)}),e.tabs&&angular.forEach(e.tabs,function(e){angular.forEach(e.items,function(e){r.traverseForm(e,t)})})},r}}]),angular.module("schemaForm").factory("sfValidator",[function(){var e={};return e.validate=function(e,t){if(!e)return{valid:!0};var r=e.schema;if(!r)return{valid:!0};""===t&&(t=void 0),"number"===e.type&&null===t&&(t=void 0);var n={type:"object",properties:{}},a=e.key[e.key.length-1];n.properties[a]=r,e.required&&(n.required=[a]);var i={};return angular.isDefined(t)&&(i[a]=t),tv4.validateResult(i,n)},e}]),angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(e,t,r,n){var a=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(i,o,l,s){var u={};i.validateArray=angular.noop,s&&i.$emit("schemaFormPropagateNgModelController",s);var c=i.$watch(l.sfArray,function(o){if(o){var l=e(o.key,i.model),f=n.normalize(o.key);if(i.$watch("model"+("["!==f[0]?".":"")+f,function(e){l=i.modelArray=e}),angular.isUndefined(l)&&(l=[],e(o.key,i.model,l)),i.modelArray=l,o.items){var d=o.items[0];o.items.length>1&&(d={type:"section",items:o.items.map(function(e){return e.ngModelOptions=o.ngModelOptions,angular.isUndefined(e.readonly)&&(e.readonly=o.readonly),e})})}if(i.copyWithIndex=function(e){if(!u[e]&&d){var r=angular.copy(d);r.arrayIndex=e,t.traverseForm(r,a(e)),u[e]=r}return u[e]},i.appendToArray=function(){var r=l.length,n=i.copyWithIndex(r);if(t.traverseForm(n,function(t){if(t.key){var r;angular.isDefined(t["default"])&&(r=t["default"]),angular.isDefined(t.schema)&&angular.isDefined(t.schema["default"])&&(r=t.schema["default"]),angular.isDefined(r)&&e(t.key,i.model,r)}}),r===l.length){var a,s=e("schema.items.type",o);"object"===s?a={}:"array"===s&&(a=[]),l.push(a)}return i.validateArray(),l},i.deleteFromArray=function(e){return l.splice(e,1),i.validateArray(),s&&s.$setDirty&&s.$setDirty(),l},o.titleMap||o.startEmpty===!0||0!==l.length||i.appendToArray(),o.titleMap&&o.titleMap.length>0){i.titleMapValues=[];var m=function(e){i.titleMapValues=[],e=e||[],o.titleMap.forEach(function(t){i.titleMapValues.push(-1!==e.indexOf(t.value))})};m(i.modelArray),i.$watchCollection("modelArray",m),i.$watchCollection("titleMapValues",function(e,t){if(e&&e!==t){for(var r=i.modelArray;r.length>0;)r.pop();o.titleMap.forEach(function(t,n){e[n]&&r.push(t.value)}),i.validateArray()}})}if(s){var p;i.validateArray=function(){var e=r.validate(o,i.modelArray.length>0?i.modelArray:void 0);Object.keys(s.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){s.$setValidity(e,!0)}),e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+o.key[o.key.length-1]||(s.$setViewValue(i.modelArray),p=e.error,s.$setValidity("tv4-"+e.error.code,!1))},i.$on("schemaFormValidate",i.validateArray),i.hasSuccess=function(){return i.options&&i.options.pristine&&i.options.pristine.success===!1?s.$valid&&!s.$pristine&&!s.$isEmpty(s.$modelValue):s.$valid&&(!s.$pristine||!s.$isEmpty(s.$modelValue))},i.hasError=function(){return i.options&&i.options.pristine&&i.options.pristine.errors===!1?s.$invalid&&!s.$pristine:s.$invalid},i.schemaError=function(){return p}}c()}})}}}]),angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(e,t,r,n){var a=e.$eval(r.sfChanged);a&&a.onChange&&n.$viewChangeListeners.push(function(){angular.isFunction(a.onChange)?a.onChange(n.$modelValue,a):e.evalExpr(a.onChange,{modelValue:n.$modelValue,form:a})})}}}),angular.module("schemaForm").directive("sfField",["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(e,t,r,n,a,i,o,l,s){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(e,t,r,n){e.$on("schemaFormPropagateNgModelController",function(t,r){t.stopPropagation(),t.preventDefault(),e.ngModel=r}),e.form=n.lookup["f"+r.sfField]},post:function(e,t,r,n){e.showTitle=function(){return e.form&&e.form.notitle!==!0&&e.form.title},e.listToCheckboxValues=function(e){var t={};return angular.forEach(e,function(e){t[e]=!0}),t},e.checkboxValuesToList=function(e){var t=[];return angular.forEach(e,function(e,r){e&&t.push(r)}),t},e.buttonClick=function(t,r){angular.isFunction(r.onClick)?r.onClick(t,r):angular.isString(r.onClick)&&(n?n.evalInParentScope(r.onClick,{$event:t,form:r}):e.$eval(r.onClick,{$event:t,form:r}))},e.evalExpr=function(t,r){return n?n.evalInParentScope(t,r):e.$eval(t,r)},e.evalInScope=function(t,r){return t?e.$eval(t,r):void 0},e.interp=function(e,t){return e&&a(e)(t)},e.hasSuccess=function(){return e.ngModel?e.options&&e.options.pristine&&e.options.pristine.success===!1?e.ngModel.$valid&&!e.ngModel.$pristine&&!e.ngModel.$isEmpty(e.ngModel.$modelValue):e.ngModel.$valid&&(!e.ngModel.$pristine||!e.ngModel.$isEmpty(e.ngModel.$modelValue)):!1},e.hasError=function(){return e.ngModel?e.options&&e.options.pristine&&e.options.pristine.errors===!1?e.ngModel.$invalid&&!e.ngModel.$pristine:e.ngModel.$invalid:!1},e.errorMessage=function(t){return o.interpolate(t&&t.code+""||"default",e.ngModel&&e.ngModel.$modelValue||"",e.ngModel&&e.ngModel.$viewValue||"",e.form,e.options&&e.options.validationMessage)};var i=e.form;i.key&&(e.$on("schemaForm.error."+i.key.join("."),function(t,r,n,a,o){o=a,(n===!0||n===!1)&&(a=n,n=void 0),(void 0==o||e.ngModel.$$parentForm.$name===o)&&e.ngModel&&r&&(e.ngModel.$setDirty?e.ngModel.$setDirty():(e.ngModel.$dirty=!0,e.ngModel.$pristine=!1),n&&(i.validationMessage||(i.validationMessage={}),i.validationMessage[r]=n),e.ngModel.$setValidity(r,a===!0),a===!0&&(e.ngModel.$validate(),e.$broadcast("schemaFormValidate")))}),e.$on("$destroy",function(){if(!e.externalDestructionInProgress){var t=i.destroyStrategy||e.options&&e.options.destroyStrategy||"remove";if(i.key&&"retain"!==t){var r=e.model;if(i.key.length>1&&(r=s(i.key.slice(0,i.key.length-1),r)),void 0===r)return;var n=i.schema&&i.schema.type||"";"empty"===t&&-1!==n.indexOf("string")?r[i.key.slice(-1)]="":"empty"===t&&-1!==n.indexOf("object")?r[i.key.slice(-1)]={}:"empty"===t&&-1!==n.indexOf("array")?r[i.key.slice(-1)]=[]:"null"===t?r[i.key.slice(-1)]=null:delete r[i.key.slice(-1)]}}}))}}}}]),angular.module("schemaForm").directive("sfMessage",["$injector","sfErrorMessage",function(e,t){var r=e.has("$sanitize")?e.get("$sanitize"):function(e){return e};return{scope:!1,restrict:"EA",link:function(e,n,a){var i="";a.sfMessage&&e.$watch(a.sfMessage,function(t){t&&(i=r(t),s(!!e.ngModel))});var o,l=function(e){e!==o&&(n.html(e),o=e)},s=function(r){if(r)if(e.hasError()){var n=[];angular.forEach(e.ngModel&&e.ngModel.$error,function(e,t){e&&n.push(t)}),n=n.filter(function(e){return"schemaForm"!==e});var a=n[0];l(a?t.interpolate(a,e.ngModel.$modelValue,e.ngModel.$viewValue,e.form,e.options&&e.options.validationMessage):i)}else l(i);else l(i)};s();var u=e.$watch("ngModel",function(e){e&&(e.$parsers.push(function(e){return s(!0),e}),e.$formatters.push(function(e){return s(!0),e}),u())});e.$watchCollection("ngModel.$error",function(){s(!!e.ngModel)})}}}]),angular.module("schemaForm").directive("sfNewArray",["sfSelect","sfPath","schemaForm",function(e,t,r){return{scope:!1,link:function(n,a,i){n.min=0,n.modelArray=n.$eval(i.sfNewArray);var o=function(){n.modelArray=n.$eval(i.sfNewArray),(!(n.ngModel&&n.ngModel.$pristine&&n.firstDigest)||n.options&&n.options.validateOnRender===!0)&&n.validateField&&n.validateField()},l=function(){n.form&&n.form.onChange&&(angular.isFunction(n.form.onChange)?n.form.onChange(n.modelArray,n.form):n.evalExpr(n.form.onChange,{modelValue:n.modelArray,form:n.form}))},s=function(){var r=n.modelArray;if(!r){var a=t.parse(i.sfNewArray);r=[],e(a,n,r),n.modelArray=r}return r},u=n.$watch("form",function(e){if(e){if(e.titleMap||e.startEmpty===!0||n.modelArray&&0!==n.modelArray.length||n.appendToArray(),n.form&&n.form.schema&&n.form.schema.uniqueItems===!0?(n.$watch(i.sfNewArray,o,!0),n.$watch([i.sfNewArray,i.sfNewArray+".length"],l)):n.$watchGroup?n.$watchGroup([i.sfNewArray,i.sfNewArray+".length"],function(){o(),l()}):(n.$watch(i.sfNewArray,function(){o(),l()}),n.$watch(i.sfNewArray+".length",function(){o(),l()})),e.titleMap&&e.titleMap.length>0){n.titleMapValues=[];var t=function(t){n.titleMapValues=[],t=t||[],e.titleMap.forEach(function(e){n.titleMapValues.push(-1!==t.indexOf(e.value))})};t(n.modelArray),n.$watchCollection("modelArray",t),n.$watchCollection("titleMapValues",function(t,r){if(t&&t!==r){var a=s();e.titleMap.forEach(function(e,r){var n=a.indexOf(e.value);-1===n&&t[r]&&a.push(e.value),-1===n||t[r]||a.splice(n,1)}),n.validateField&&n.validateField()}})}u()}});n.appendToArray=function(){var t,a=s();if(n.form&&n.form.schema&&n.form.schema.items){var i=n.form.schema.items;i.type&&-1!==i.type.indexOf("object")?(t={},n.options&&n.options.setSchemaDefaults===!1||(t=angular.isDefined(i["default"])?i["default"]:t,t&&r.traverseSchema(i,function(r,n){angular.isDefined(r["default"])&&e(n,t,r["default"])}))):i.type&&-1!==i.type.indexOf("array")?(t=[],n.options&&n.options.setSchemaDefaults===!1||(t=i["default"]||t)):n.options&&n.options.setSchemaDefaults===!1||(t=i["default"]||t)}return a.push(t),a},n.deleteFromArray=function(e){var t=n.modelArray;return t&&t.splice(e,1),t};var c=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}},f={};n.copyWithIndex=function(e){var t=n.form;if(!f[e]){var a=t.items[0];if(t.items.length>1&&(a={type:"section",items:t.items.map(function(e){return e.ngModelOptions=t.ngModelOptions,angular.isUndefined(e.readonly)&&(e.readonly=t.readonly),e})}),a){var i=angular.copy(a);i.arrayIndex=e,r.traverseForm(i,c(e)),f[e]=i}}return f[e]}}}}]),angular.module("schemaForm").directive("sfSchema",["$compile","$http","$templateCache","$q","schemaForm","schemaFormDecorators","sfSelect","sfPath","sfBuilder",function(e,t,r,n,a,i,o,l,s){return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(e){this.evalInParentScope=function(t,r){return e.$parent.$eval(t,r)};var t=this;e.lookup=function(e){return e&&(t.lookup=e),t.lookup}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(l,u,c,f,d){l.formCtrl=f;var m={};d(l,function(e){if(e.addClass("schema-form-ignore"),u.prepend(e),u[0].querySelectorAll){var t=u[0].querySelectorAll("[ng-model]");if(t)for(var r=0;r<t.length;r++){var n=t[r].getAttribute("ng-model");m[n.substring(n.indexOf(".")+1)]=!0}}});var p,h={},g=function(e,i){var o=[],s=a.merge(e,i,m,l.options,void 0,o);o.length>0?n.all(o.map(function(e){return t.get(e.templateUrl,{cache:r}).then(function(t){e.template=t.data})})).then(function(){v(e,i,s)}):v(e,i,s)},v=function(t,r,n){p&&(l.externalDestructionInProgress=!0,p.$destroy(),l.externalDestructionInProgress=!1),p=l.$new(),p.schemaForm={form:n,schema:t},u.children(":not(.schema-form-ignore)").remove();for(var f={},d=u[0].querySelectorAll("*[sf-insert-field]"),m=0;m<d.length;m++)f[d[m].getAttribute("sf-insert-field")]=d[m];var h=i.decorator(c.sfUseDecorator),g=Object.create(null);l.lookup(g),u[0].appendChild(s.build(n,h,f,g)),p.firstDigest=!0,setTimeout(function(){p.firstDigest=!1},0),e(u.children())(p),l.options&&l.options.setSchemaDefaults===!1||a.traverseSchema(t,function(e,t){if(angular.isDefined(e["default"])){var r=o(t,l.model);angular.isUndefined(r)&&o(t,l.model,e["default"])}}),l.$emit("sf-render-finished",u)},y=["*"];l.$watch(function(){var e=l.schema,t=l.initialForm||y;t&&e&&e.type&&(h.form!==t||h.schema!==e)&&Object.keys(e.properties).length>0&&(h.schema=e,h.form=t,g(e,t))}),l.$on("schemaFormRedraw",function(){var e=l.schema,t=l.initialForm?angular.copy(l.initialForm):["*"];e&&g(e,t)}),l.$on("$destroy",function(){l.externalDestructionInProgress=!0}),l.evalExpr=function(e,t){return l.$parent.$eval(e,t)}}}}]),angular.module("schemaForm").directive("schemaValidate",["sfValidator","$parse","sfSelect",function(e,t,r){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(t,n,a,i){t.$emit("schemaFormPropagateNgModelController",i);var o=null,l=t.$eval(a.schemaValidate);l.copyValueTo&&i.$viewChangeListeners.push(function(){var e=l.copyValueTo;angular.forEach(e,function(e){r(e,t.model,i.$modelValue)})});var s=function(r){
if(!l)return r;if(t.options&&t.options.tv4Validation===!1)return r;var n=e.validate(l,r);return Object.keys(i.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){i.$setValidity(e,!0)}),n.valid?r:(i.$setValidity("tv4-"+n.error.code,!1),o=n.error,i.$validators?r:void 0)};"function"==typeof l.ngModel&&l.ngModel(i),["$parsers","$viewChangeListeners","$formatters"].forEach(function(e){l[e]&&i[e]&&l[e].forEach(function(t){i[e].push(t)})}),["$validators","$asyncValidators"].forEach(function(e){l[e]&&i[e]&&angular.forEach(l[e],function(t,r){i[e][r]=t})}),i.$parsers.push(s),i.$validators&&(i.$validators.schemaForm=function(){return!Object.keys(i.$error).some(function(e){return"schemaForm"!==e})});var u=l.schema;t.validateField=function(e){(void 0==e||i.$$parentForm.$name===e)&&(u&&-1!==u.type.indexOf("array")&&s(i.$modelValue),i.$setDirty?(i.$setDirty(),i.$setViewValue(i.$viewValue),i.$commitViewValue(),l.required&&i.$isEmpty(i.$modelValue)&&i.$setValidity("tv4-302",!1)):i.$setViewValue(i.$viewValue))},i.$formatters.push(function(e){return!i.$pristine||!t.firstDigest||t.options&&t.options.validateOnRender===!0?(s(i.$modelValue),e):e}),t.$on("schemaFormValidate",function(e,r){t.validateField(r)}),t.schemaError=function(){return o}}}}]);